<h2>Set Classified Location</h2>
<h3>Global Position</h3>
<div>
 <div style="float:left;width:40%">
  <label>
  Lattitude:
		<input type="text" name="lattitude" id="lattitude" value="">
	    </label>
<label>
  Longitude:
		<input type="text" name="longitude" id="longitude" value="">
	    </label>
   <input type="hidden" name="id" value="">
  </div>	  
  <div style="float:left;width:60%">
  <div id="map" style="width:100%;height:300px;"></div>
</div>
<script>
 var map = new google.maps.Map(document.getElementById("map"), {
   center: new google.maps.LatLng(53.3478, -6.2597),
   zoom: 16,
   mapTypeId: google.maps.MapTypeId.ROADMAP
 });

 var infoWindow = new google.maps.InfoWindow({
   map: map
 });
 // Try HTML5 geolocation.
 if (navigator.geolocation) {
   navigator.geolocation.getCurrentPosition(function(position) {
     $('#lattitude').val(position.coords.latitude);
      $('#longitude').val(position.coords.longitude);
     var pos = {
       lat: position.coords.latitude,
       lng: position.coords.longitude
     };
     infoWindow.setPosition(pos);
     infoWindow.setContent('<b>You are here.</b>');
     map.setCenter(pos);
     var marker = new google.maps.Marker({
       position: pos,
       map: map,
       title: getCityStateVGAPI(pos),
     });
   }, function() {
     handleLocationError(true, infoWindow, map.getCenter());
   });
 } else {
   // Browser doesn't support Geolocation
   handleLocationError(false, infoWindow, map.getCenter());
 }
function getCityStateVGAPI(position){

	var x = position.coords.latitude;
	var y = position.coords.longitude;
	var url = '//maps.googleapis.com/maps/api/geocode/json?latlng='+x+','+y+'&sensor=true';
	//console.log(url);
	$.get(url, function (response) {
		//console.log(response);
		var data = response;
		var addressComponents = data.results[0].address_components;
		
		//console.log(addressComponents);
		var city = "";
		var state = "";
		for(i=0;i<addressComponents.length;i++){
			var types = addressComponents[i].types
			if(types=="locality,political"){
			   city = addressComponents[i].short_name;
			}
			if(types=="administrative_area_level_1,political"){
			   state = addressComponents[i].short_name;
			}
		}
		return city + ', ' + state;
	}, "json");

}
</script>
